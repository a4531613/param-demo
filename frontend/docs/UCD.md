# 参数配置中心（UCD / 以用户为中心设计）

本文件用于在不改变业务目标的前提下，统一“参数配置中心”的用户角色、关键场景、信息架构与交互规范，降低企业环境下的认知负担与误操作风险。

---

## 1. 产品目标与设计原则

### 1.1 业务目标（不变）

- 以“版本化 + 环境隔离”方式治理配置，支持快速变更、可追溯、可回滚/可比对。
- 以“角色权限 + 审计日志”保障安全合规与责任追踪。
- 对外提供读取接口，支撑业务系统稳定获取配置。

### 1.2 体验目标（提升）

- 易用：新用户按“主路径”可完成从 0 到发布的全流程。
- 一致：同类页面的筛选、列表、表单、反馈与状态呈现一致。
- 可控：任何破坏性/不可逆行为都有明确约束、提示与可追溯记录。

### 1.3 设计原则（企业级）

- 先约束后自由：先把“能不能做/在哪做”讲清楚，再提供高效操作。
- 先信息后动作：先显示“当前上下文（应用/环境/类型/版本）”，再展示可用动作。
- 少打断、强反馈：常规操作 toast；高风险操作 confirm；失败给出可行动建议。
- 默认安全：默认只看启用；默认选择可用版本；归档版本显式不可写。

---

## 2. 用户角色与权限模型

### 2.1 角色定义（面向组织协作）

- 管理员（admin）：平台治理与全量运维，拥有全功能权限，负责合规与审计。
- 应用负责人（appowner）：应用域内的版本发布与关键配置维护（以应用为边界）。
- 配置维护（editor）：日常字段/数据维护（不越权跨应用/跨环境治理规则）。
- 只读（viewer）：仅查看，不允许写入（新增/修改/删除）。
- 审计（auditor）：以审计为主，查看操作轨迹与关键数据，不允许写入。

> 说明：当前系统以 `X-Role` 进行服务端能力约束，前端应做“可见/可用”一致映射，避免“点了才报错”。

### 2.2 权限矩阵（能力 → 角色）

| 能力域 | admin | appowner | editor | viewer | auditor |
| --- | --- | --- | --- | --- | --- |
| 基础配置：应用/环境/类型/大类 | ✅ | ⚠️（仅应用域） | ⚠️（仅维护部分） | ❌ | ❌ |
| 版本：创建/发布/归档 | ✅ | ✅（应用域） | ⚠️（按治理规则） | ❌ | ❌ |
| 字段：维护字段结构 | ✅ | ✅（应用域） | ✅（可编辑版本） | ❌ | ❌ |
| 数据：维护配置数据 | ✅ | ✅（应用域） | ✅（可编辑版本） | ❌ | ❌ |
| 查询：配置数据查询/版本对比 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 审计：查看审计日志 | ✅ | ✅ | ✅ | ✅ | ✅（主入口） |

注：实际约束以服务端为准；前端用于降低误操作与解释成本。

---

## 3. 核心使用场景（Jobs To Be Done）

### 3.1 初始化（从 0 到可维护）

- 创建应用与环境，建立“配置域”边界（多应用/多环境隔离）。
- 创建类型/大类，形成可扩展的配置目录。

### 3.2 变更（从需求到落地）

- 创建版本（可追溯载体）。
- 维护字段结构（动态字段）。
- 录入/调整配置数据（按版本、环境、类型，支持跨环境预览/覆盖）。

### 3.3 发布（从草稿到生效）

- 对变更进行预览与差异确认（版本对比、数据预览）。
- 发布到可用态，并自动归档历史版本，避免对历史版本误改。

### 3.4 运营与排障（从现象到定位）

- 关键字查询已发布/已归档版本的配置（跨版本/跨环境检索）。
- 一键预览当前上下文的配置快照（用于沟通、核对与问题定位）。
- 通过审计日志定位“谁在何时改了什么”。

---

## 4. 关键用户旅程与业务主路径

### 4.1 新建上线旅程（管理员 / 应用负责人）

1. 创建应用（应用编码、名称）
2. 创建环境（dev/test/pre/prod 等）
3. 创建类型/大类（编码、名称、排序）
4. 创建版本（版本号、说明）
5. 维护字段（字段码、类型、校验、默认值、是否唯一键组成）
6. 录入配置数据（Key + 字段值，按环境隔离）
7. 预览/对比确认（预览快照，检查关键 Key）
8. 发布版本 → 进入审计闭环（形成可追溯记录）

### 4.2 日常变更旅程（配置维护 / 应用负责人）

1. 选择应用 → 选择版本（默认优先已发布）
2. 在“字段/配置数据”中完成变更
3. 用“只看启用 + 关键字搜索”快速定位目标 Key
4. 跨环境预览/覆盖避免漏改（必要时）
5. 发布前用“版本对比”核对影响面
6. 发布后用“配置数据查询”验证生效

### 4.3 排障旅程（只读 / 审计 / 值班）

1. 从“配置数据查询”输入关键字定位 Key 与字段值
2. 确认来源版本与环境（避免把“预发布/生产”混淆）
3. 查看“版本对比”确认最近变更点
4. 打开“审计日志”追溯操作人、时间与变更对象

---

## 5. 信息架构（IA）与页面层级

### 5.1 全局信息架构（侧边栏）

- 概览：系统说明与主路径引导
- 基础配置：应用 / 环境 / 配置类型 / 字段管理
- 版本与发布：版本管理 / 版本对比
- 配置操作：配置数据 / 配置数据查询
- 审计日志

### 5.2 关键上下文（全局一致）

所有“配置数据相关页面”都必须明确展示并使用以下上下文：

- 应用（App）
- 环境（Env）
- 类型/大类（Type/Group）
- 版本（Version：已发布/已归档）

设计要求：

- 上下文变更会触发数据刷新，并清空不再适用的选择状态（避免误操作）。
- 归档版本所有写入入口禁用，并给出原因说明。

---

## 6. 交互规范与操作反馈（统一标准）

### 6.1 反馈分级（统一策略）

- 成功：toast（短、肯定、无歧义），如“已保存”“已删除”“发布成功”。
- 可恢复的校验问题：toastWarning，给出修正建议，如“Key 不能为空”“请选择环境与类型”。
- 高风险/不可逆：confirm（二次确认），明确影响面与后果。
- 系统错误/网络错误：toastError，包含“原因 + 下一步”，如“加载失败：请稍后重试/检查权限”。

落地：统一使用 `frontend/src/ui/feedback.js`。

### 6.2 状态呈现（列表/表单通用）

- Loading：局部加载优先（按钮 loading、表格 loading），避免全屏阻断。
- Empty：必须给“下一步动作”，例如“新增配置”“清除搜索”。
- Disabled：禁用的按钮必须配套可解释文案（tooltip 或 toast）。
- Read-only：只读/审计角色不展示写入口或保持禁用一致，不出现“点了才失败”。

### 6.3 表单与校验（数据一致性）

- Key：必填、不可空、需唯一（当前环境/类型/版本范围内）。
- 字段值：按字段类型渲染；校验失败就地提示，不把用户赶去别处找原因。

### 6.4 降低认知负担（默认值与快捷操作）

- 默认只看启用；需要查看停用时显式切换。
- 配置数据页提供关键字搜索（Key/字段值），优先支持“找得到”。
- 批量操作应显示“已选数量”和禁用原因（例如存在未停用项时不允许删除）。

---

## 7. 配置数据页（核心页面）体验要点

### 7.1 用户任务

- 快速定位：通过“只看启用 + 关键字搜索”找到目标 Key。
- 安全编辑：在可编辑版本中新增/修改配置，归档版本不可写。
- 环境一致性：跨环境预览/覆盖用于减少遗漏（明确当前环境为主环境）。
- 可沟通验证：一键预览用于沟通核对与发布前确认。

### 7.2 关键交互（建议固化）

- 搜索：支持清除；搜索变化时清空勾选，避免“选中项被过滤后误删”。
- 空结果：显示“未找到匹配结果”，并提供“清除搜索”。
- 风险操作：批量删除/跨环境覆盖必须二次确认。

---

## 8. 指标与验收（体验可量化）

- 首次成功率：新用户在 15 分钟内完成“创建应用→发布版本”的成功率。
- 查找效率：在配置数据页通过关键字定位 Key 的平均耗时。
- 误操作率：删除/覆盖类操作的撤销/投诉比例（以审计日志回溯为证）。
- 一致性：同类页面的“筛选-列表-编辑-反馈”模式一致，通过评审 Checklist 验收。

---

## 9. 交付物与演进方式

- 本文作为“产品 + 架构”共同约束：新增功能必须先补充到“场景/旅程/IA/交互规范”。
- UI 组件与反馈文案复用优先，避免在不同页面出现不同表达与操作方式。
